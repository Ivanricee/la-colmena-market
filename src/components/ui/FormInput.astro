---
interface Props {
  id: string
  name: string
  type?: 'text' | 'tel' | 'email' | 'textarea'
  label: string
  placeholder?: string
  optional?: boolean
  class?: string
  model?: string
  errorKey?: string
  blurHandler?: string
  inputHandler?: string
}

const {
  id,
  name,
  type = 'text',
  label,
  placeholder = '',
  optional = false,
  class: className = '',
  model,
  errorKey,
  blurHandler,
  inputHandler,
} = Astro.props

const errorId = errorKey ? `error-${id}` : undefined

const inputClasses = [
  'w-full rounded-lg border border-border/80 bg-background px-4 py-3',
  'text-foreground placeholder:text-muted-foreground/80',
  'focus:border-honey-dark focus:outline-none focus:ring-1 focus:ring-ring',
  'transition-colors duration-200',
  className,
].join(' ')
---

<div class="flex flex-col gap-2">
  <label for={id} class="text-sm font-medium text-foreground">
    {label}
    {optional && <span class="text-muted-foreground"> (opcional)</span>}
  </label>

  {
    type === 'textarea' ? (
      <textarea
        id={id}
        name={name}
        placeholder={placeholder}
        class={`${inputClasses} min-h-[100px] resize-none`}
        x-model={model}
        x-on:input={inputHandler}
        x-on:blur={blurHandler}
        x-bind:aria-invalid={errorKey ? `!!errors.${errorKey}` : undefined}
        aria-describedby={errorId}
      />
    ) : (
      <input
        id={id}
        name={name}
        type={type}
        placeholder={placeholder}
        class={inputClasses}
        x-model={model}
        x-on:input={inputHandler}
        x-on:blur={blurHandler}
        x-bind:aria-invalid={errorKey ? `!!errors.${errorKey}` : undefined}
        aria-describedby={errorId}
      />
    )
  }

  {
    errorKey && (
      <p
        id={errorId}
        role="alert"
        class="text-sm text-destructive"
        x-show={`!!errors.${errorKey}`}
        x-text={`errors.${errorKey}?.[0] ?? ''`}
        x-cloak
      />
    )
  }
</div>
