---
import { Icon } from 'astro-icon/components'
import Button from './Button.astro'
interface Props {
  cantidad: number
}
const { cantidad } = Astro.props
---

<div
  class="w-full"
  x-data="{
    open: false,
    selected: 1,
    close() {
      this.open = false
      this.$refs.button.focus()
    }
  }"
  @keydown.escape.prevent.stop="close()"
>
  <input type="hidden" name="cantidad" x-model="selected" />
  <Button
    variant="default"
    x-ref="button"
    @click="open = !open"
    @click.outside="open = false"
    :aria-expanded="open"
    aria-haspopup="true"
    class:list={[
      'bg-secondary/25 hover:bg-secondary/70 hover:text-foreground focus:ring-ring/40 rounded-md',
      'text-foreground border-border/25 box-border inline-flex h-full w-full items-center justify-center border',
      'px-2 py-2.5 text-sm leading-5 font-semibold shadow-none transition-colors duration-300 focus:ring-2 focus:outline-none',
      '',
    ]}
    type="button"
  >
    Cantidad {` `}
    <span class="px-1 pr-2" x-text="selected"></span>
    <Icon
      :class="open ? 'rotate-180' : 'rotate-0'"
      class="transition-transform duration-300"
      name="lucide:chevron-down"
      size={16}
    />
  </Button>

  <!-- Dropdown menu -->
  <div
    x-show="open"
    x.transition.origin.top.left
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 "
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    x-cloak
    class="bg-background border-border/50 absolute z-10 w-44 rounded-md border shadow-lg"
  >
    <ul class="text-body p-2 text-sm font-semibold" aria-labelledby="dropdownDefaultButton">
      {
        Array.from({ length: cantidad }, (_, i) => (
          <li class="hover:bg-secondary/70 text-muted-foreground transition-colors duration-300">
            <button
              type="button"
              @click={`selected = ${i + 1}; close()`}
              class="hover:bg-neutral-tertiary-medium hover:text-heading inline-flex w-full items-center rounded p-2"
            >
              Cantidad: {i + 1}
            </button>
          </li>
        ))
      }
    </ul>
  </div>
</div>
