---
import { getCategories } from '@/features/categories/categories.api'
import Layout from '../layouts/Layout.astro'
import type { Category } from '@/features/categories/categories.api'

import Button from '@/components/ui/Button.astro'
import { Icon } from 'astro-icon/components'
import { getProducts } from '@/features/products/products.api'
import ProductCard from '@/features/products/components/ProductCard.astro'

const [categoriesData, productsData] = await Promise.all([
  getCategories(),
  getProducts({ where: { featured: true } }),
])
const { categories, errorMessage: categoriesError } = categoriesData
const { productos, errorMessage: productsError } = productsData
---

<Layout title="La Colmena Market">
  {
    categoriesError || productsError ? (
      <section>
        <h1>Error</h1>
        <p>{categoriesError ?? productsError}</p>
      </section>
    ) : (
      <>
        {/* Hero Section */}
        {categories.map((category) => (
          <section class="relative h-[600px] overflow-hidden">
            <div class="absolute inset-0 bg-cover bg-center bg-[url('../assets/hero-honey.jpg')]">
              <div class="absolute inset-0 bg-gradient-to-r from-background/95 to-background/60" />
            </div>

            <div class="container relative mx-auto px-4 sm:px-6 lg:px-8 h-full flex items-center">
              <div class="max-w-2xl space-y-6">
                <h1 class="text-5xl md:text-6xl font-bold text-foreground leading-tight">
                  Tus productos favoritos{' '}
                  <span class="from-primary bg-linear-to-r to-orange-400 bg-clip-text text-transparent">
                    hechos con miel.
                  </span>
                </h1>
                <p class="text-xl text-muted-foreground">
                  Descubre nuestra selección de productos naturales para tu cuidado personal y tu
                  cocina. Todo lo que necesitas para tu bienestar, 100% natural.
                </p>
                <div class="flex gap-4">
                  <Button
                    href={`/product/${category.slug}`}
                    size="lg"
                    class="bg-primary hover:bg-primary/90"
                  >
                    Explorar la tienda
                    <Icon name="lucide:arrow-right" size={20} />
                  </Button>
                </div>
              </div>
            </div>
          </section>
        ))}

        {/* Features */}
        <section class="py-16 border-y border-border bg-gradient-warm">
          <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              <div class="flex flex-col items-center text-center space-y-3">
                <div class="h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center">
                  <Icon name="lucide:leaf" size={20} />
                </div>
                <h3 class="text-lg font-semibold text-foreground">100% Natural</h3>
                <p class="text-muted-foreground">Sin conservantes ni procesos industriales.</p>
              </div>
              <div class="flex flex-col items-center text-center space-y-3">
                <div class="h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center">
                  <Icon name="lucide:shield-check" size={20} />
                </div>
                <h3 class="text-lg font-semibold text-foreground">Gran Variedad</h3>
                <p class="text-muted-foreground">
                  Soluciones naturales para tu salud, belleza y hogar.
                </p>
              </div>
              <div class="flex flex-col items-center text-center space-y-3">
                <div class="h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center">
                  <Icon name="lucide:phone-call" size={20} />
                </div>
                <h3 class="text-lg font-semibold text-foreground">Compra Directa</h3>
                <p class="text-muted-foreground">Pide por WhatsApp con atención personal.</p>
              </div>
            </div>
          </div>
        </section>
        {/* Featured Products */}
        <section class="py-20">
          <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center space-y-4 mb-12">
              <h2 class="text-4xl font-bold text-foreground">Productos Destacados</h2>
              <p class="text-lg text-muted-foreground max-w-2xl text-center mx-auto">
                Nuestra selección premium de mieles más populares, escogidas especialmente para ti
              </p>
            </div>

            <ul class="grid auto-rows-[30rem] grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
              {productos.map((product, index) => (
                <li>
                  <div
                    class:list={[
                      'group shadow-honey-dark/30 @container h-full overflow-hidden',
                      ' rounded-lg transition-all duration-500 hover:scale-[1.03] hover:shadow-2xl',
                    ]}
                  >
                    <ProductCard product={product} />
                  </div>
                </li>
              ))}
            </ul>
          </div>
        </section>
        <footer class="py-12 border-t border-border">
          <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-muted-foreground">
              <p>© 2026 La colmena Market.</p>
            </div>
          </div>
        </footer>
      </>
    )
  }
</Layout>
